<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cabax Admin Pro - Luxury Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * { 
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --luxury-black: #0a0a0a;
            --luxury-dark: #1a1a1a;
            --luxury-gray: #2a2a2a;
            --luxury-gold: #d4af37;
            --luxury-light: #f5f5f5;
        }
        
        body { 
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            color: #f5f5f5;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        
        .gold-accent {
            background: linear-gradient(135deg, #d4af37 0%, #f4d03f 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .luxury-card {
            background: rgba(26, 26, 26, 0.6);
            border: 1px solid rgba(212, 175, 55, 0.15);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .luxury-card:hover {
            border-color: rgba(212, 175, 55, 0.4);
            box-shadow: 0 8px 32px rgba(212, 175, 55, 0.12);
            transform: translateY(-2px);
        }
        
        .luxury-btn {
            background: linear-gradient(135deg, #d4af37 0%, #f4d03f 100%);
            color: #0a0a0a;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
        }
        
        .luxury-btn:hover {
            box-shadow: 0 8px 24px rgba(212, 175, 55, 0.35);
            transform: translateY(-1px);
        }
        
        .sidebar-luxury {
            background: linear-gradient(180deg, rgba(10, 10, 10, 0.98) 0%, rgba(26, 26, 26, 0.98) 100%);
            border-right: 1px solid rgba(212, 175, 55, 0.15);
            backdrop-filter: blur(10px);
        }
        
        .menu-image-container {
            width: 100%;
            height: 240px;
            overflow: hidden;
            border-radius: 16px 16px 0 0;
            background: rgba(42, 42, 42, 0.5);
            position: relative;
        }
        
        .menu-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .menu-image:hover {
            transform: scale(1.05);
        }
        
        .image-upload-area {
            border: 2px dashed rgba(212, 175, 55, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
            background: rgba(42, 42, 42, 0.3);
        }
        
        .image-upload-area:hover {
            border-color: rgba(212, 175, 55, 0.6);
            background: rgba(212, 175, 55, 0.05);
        }
        
        .image-preview {
            max-width: 100%;
            max-height: 300px;
            border-radius: 12px;
            margin-top: 12px;
        }
        
        @media (max-width: 768px) {
            .sidebar-mobile { transform: translateX(-100%); transition: transform 0.3s; }
            .sidebar-mobile.active { transform: translateX(0); }
        }
        
        @media print {
            .no-print { display: none !important; }
        }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeInUp 0.4s ease-out; }
        .modal { display: none; }
        .modal.active { display: flex; }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fade-in { animation: fadeInUp 0.5s ease-out; }
        
        .notification {
            position: fixed;
            top: 24px;
            right: 24px;
            z-index: 9999;
            animation: fadeInUp 0.3s;
            min-width: 300px;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }
        
        .calendar-cell {
            min-height: 80px;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.2s ease;
        }
        
        .calendar-cell:hover {
            background: rgba(212, 175, 55, 0.05);
        }
        
        .shift-badge {
            font-size: 0.7rem;
            padding: 4px 8px;
            border-radius: 6px;
            background: linear-gradient(135deg, #d4af37 0%, #f4d03f 100%);
            color: #0a0a0a;
            font-weight: 600;
            display: inline-block;
            margin-top: 4px;
        }
        
        input, select, textarea {
            background: rgba(255, 255, 255, 0.04) !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            color: #f5f5f5 !important;
            transition: all 0.2s ease;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: rgba(212, 175, 55, 0.5) !important;
            outline: none !important;
            background: rgba(255, 255, 255, 0.06) !important;
        }
        
        table {
            background: rgba(26, 26, 26, 0.4);
        }
        
        thead {
            background: rgba(212, 175, 55, 0.08) !important;
        }
        
        tbody tr {
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: background 0.2s ease;
        }
        
        tbody tr:hover {
            background: rgba(212, 175, 55, 0.06);
        }
        
        .nav-btn.active {
            background: rgba(212, 175, 55, 0.15);
            border-left: 3px solid #d4af37;
            color: #f4d03f;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .status-available { background: #10b981; }
        .status-occupied { background: #ef4444; }
        .status-reserved { background: #f59e0b; }
        
        scrollbar-width: thin;
        scrollbar-color: rgba(212, 175, 55, 0.3) rgba(26, 26, 26, 0.3);
        
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(26, 26, 26, 0.3);
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(212, 175, 55, 0.3);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(212, 175, 55, 0.5);
        }
    </style>
</head>
<body>
    <div id="notificationArea"></div>

    <!-- ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ -->
    <div id="loginPage" class="min-h-screen flex items-center justify-center p-4">
        <div class="w-full max-w-md p-10 glass-effect rounded-3xl shadow-2xl animate-fade-in">
            <div class="text-center mb-10">
                <h2 class="text-5xl font-bold gold-accent mb-3">Cabax</h2>
                <div class="w-16 h-1 bg-gradient-to-r from-transparent via-yellow-600 to-transparent mx-auto mb-4"></div>
                <p class="text-sm text-gray-400 tracking-wide">LUXURY MANAGEMENT SYSTEM</p>
            </div>
            <form onsubmit="handleLogin(event)" class="space-y-5">
                <input type="text" id="shopCode" value="SHOP001" placeholder="åº—èˆ—ã‚³ãƒ¼ãƒ‰" class="w-full px-5 py-4 rounded-xl text-sm">
                <input type="email" id="email" value="admin@example.com" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹" class="w-full px-5 py-4 rounded-xl text-sm">
                <input type="password" id="password" value="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" class="w-full px-5 py-4 rounded-xl text-sm">
                <button type="submit" class="w-full py-4 luxury-btn rounded-xl font-semibold text-sm tracking-wide">
                    ãƒ­ã‚°ã‚¤ãƒ³
                </button>
            </form>
        </div>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ -->
    <div id="dashboardPage" class="hidden">
        <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
        <div id="sidebar" class="fixed inset-y-0 left-0 z-40 w-72 sidebar-luxury sidebar-mobile md:translate-x-0 no-print">
            <div class="flex h-full flex-col">
                <div class="flex h-24 items-center justify-center px-6 border-b border-gray-800">
                    <h1 class="text-3xl font-bold gold-accent tracking-tight">Cabax</h1>
                </div>
                
                <div class="border-b border-gray-800 p-6">
                    <p class="text-xs text-gray-500 uppercase tracking-widest mb-2">å–¶æ¥­æ—¥</p>
                    <p class="text-sm font-medium text-gray-300" id="businessDate"></p>
                </div>
                
                <nav class="flex-1 overflow-y-auto px-4 py-6 space-y-1">
                    <button onclick="showTab('dashboard')" class="nav-btn active w-full flex items-center gap-3 rounded-xl px-4 py-3.5 text-sm text-gray-300 hover:bg-gray-800/50 transition">
                        <span class="text-lg">ğŸ“Š</span>
                        <span>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</span>
                    </button>
                    <button onclick="showTab('tables')" class="nav-btn w-full flex items-center gap-3 rounded-xl px-4 py-3.5 text-sm text-gray-300 hover:bg-gray-800/50 transition">
                        <span class="text-lg">ğŸª‘</span>
                        <span>ãƒ†ãƒ¼ãƒ–ãƒ«ç®¡ç†</span>
                    </button>
                    <button onclick="showTab('attendance')" class="nav-btn w-full flex items-center gap-3 rounded-xl px-4 py-3.5 text-sm text-gray-300 hover:bg-gray-800/50 transition">
                        <span class="text-lg">â°</span>
                        <span>å‹¤æ€ ç®¡ç†</span>
                    </button>
                    <button onclick="showTab('shifts')" class="nav-btn w-full flex items-center gap-3 rounded-xl px-4 py-3.5 text-sm text-gray-300 hover:bg-gray-800/50 transition">
                        <span class="text-lg">ğŸ“…</span>
                        <span>ã‚·ãƒ•ãƒˆç®¡ç†</span>
                    </button>
                    <button onclick="showTab('menu')" class="nav-btn w-full flex items-center gap-3 rounded-xl px-4 py-3.5 text-sm text-gray-300 hover:bg-gray-800/50 transition">
                        <span class="text-lg">ğŸ½ï¸</span>
                        <span>ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç†</span>
                    </button>
                    <button onclick="showTab('casts')" class="nav-btn w-full flex items-center gap-3 rounded-xl px-4 py-3.5 text-sm text-gray-300 hover:bg-gray-800/50 transition">
                        <span class="text-lg">ğŸ‘¥</span>
                        <span>ã‚­ãƒ£ã‚¹ãƒˆç®¡ç†</span>
                    </button>
                    <button onclick="showTab('reports')" class="nav-btn w-full flex items-center gap-3 rounded-xl px-4 py-3.5 text-sm text-gray-300 hover:bg-gray-800/50 transition">
                        <span class="text-lg">ğŸ“ˆ</span>
                        <span>å£²ä¸Šãƒ¬ãƒãƒ¼ãƒˆ</span>
                    </button>
                </nav>
                
                <div class="border-t border-gray-800 p-4">
                    <button onclick="logout()" class="w-full bg-red-900/20 text-red-400 border border-red-800/30 py-3.5 rounded-xl hover:bg-red-900/30 transition text-sm font-medium">
                        ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
                    </button>
                </div>
            </div>
        </div>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <div class="md:pl-72 min-h-screen">
            <main class="p-6 md:p-10">
                
                <!-- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ -->
                <div id="dashboard-tab" class="tab-content active">
                    <div class="mb-10">
                        <h1 class="text-5xl font-bold gold-accent mb-4">Dashboard</h1>
                        <p class="text-gray-400 text-lg mb-8">ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å–¶æ¥­çŠ¶æ³</p>
                        <div class="flex flex-wrap gap-3">
                            <button onclick="syncWithBackend()" class="luxury-btn px-8 py-3.5 rounded-xl text-sm">
                                ğŸ”„ APIåŒæœŸ
                            </button>
                            <button onclick="printDailyReport()" class="bg-gray-800 text-gray-300 px-8 py-3.5 rounded-xl hover:bg-gray-700 transition text-sm">
                                ğŸ–¨ï¸ æ—¥å ±å°åˆ·
                            </button>
                            <button onclick="exportCSV()" class="bg-gray-800 text-gray-300 px-8 py-3.5 rounded-xl hover:bg-gray-700 transition text-sm">
                                ğŸ“¥ CSVå‡ºåŠ›
                            </button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
                        <div class="luxury-card rounded-2xl p-8 shadow-xl">
                            <p class="text-sm text-gray-400 mb-3 uppercase tracking-wide">æœ¬æ—¥ã®å£²ä¸Š</p>
                            <p class="text-4xl font-bold gold-accent" id="totalSales">Â¥0</p>
                        </div>
                        <div class="luxury-card rounded-2xl p-8 shadow-xl">
                            <p class="text-sm text-gray-400 mb-3 uppercase tracking-wide">æ¥åº—çµ„æ•°</p>
                            <p class="text-4xl font-bold text-gray-200" id="totalCustomers">0çµ„</p>
                        </div>
                        <div class="luxury-card rounded-2xl p-8 shadow-xl">
                            <p class="text-sm text-gray-400 mb-3 uppercase tracking-wide">å‡ºå‹¤ä¸­</p>
                            <p class="text-4xl font-bold text-gray-200" id="workingCasts">0å</p>
                        </div>
                        <div class="luxury-card rounded-2xl p-8 shadow-xl">
                            <p class="text-sm text-gray-400 mb-3 uppercase tracking-wide">å®¢å˜ä¾¡</p>
                            <p class="text-4xl font-bold text-gray-200" id="averageSpend">Â¥0</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="luxury-card rounded-2xl p-8 shadow-xl">
                            <h3 class="text-xl font-semibold mb-6 text-gray-200">æ™‚é–“å¸¯åˆ¥å£²ä¸Š</h3>
                            <canvas id="salesChart"></canvas>
                        </div>
                        <div class="luxury-card rounded-2xl p-8 shadow-xl">
                            <h3 class="text-xl font-semibold mb-6 text-gray-200">æœ€è¿‘ã®æ´»å‹•</h3>
                            <div id="recentActivities" class="space-y-4"></div>
                        </div>
                    </div>
                </div>

                <!-- å‹¤æ€ ç®¡ç†ã‚¿ãƒ– -->
                <div id="attendance-tab" class="tab-content">
                    <h1 class="text-5xl font-bold gold-accent mb-10">å‹¤æ€ ç®¡ç†</h1>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-10">
                        <div class="luxury-card rounded-2xl p-8 shadow-xl">
                            <h3 class="text-2xl font-semibold mb-6 text-gray-200">ğŸ“ æ‰“åˆ»</h3>
                            <select id="attendanceCast" class="w-full rounded-xl px-5 py-4 mb-6 text-sm">
                                <option value="">ã‚­ãƒ£ã‚¹ãƒˆã‚’é¸æŠ</option>
                            </select>
                            <div class="grid grid-cols-2 gap-4">
                                <button onclick="clockIn()" class="bg-green-900/30 border border-green-700/50 text-green-400 py-5 rounded-xl font-semibold hover:bg-green-900/50 transition">
                                    âœ… å‡ºå‹¤
                                </button>
                                <button onclick="clockOut()" class="bg-red-900/30 border border-red-700/50 text-red-400 py-5 rounded-xl font-semibold hover:bg-red-900/50 transition">
                                    âŒ é€€å‹¤
                                </button>
                            </div>
                        </div>

                        <div class="luxury-card rounded-2xl p-8 shadow-xl">
                            <h3 class="text-2xl font-semibold mb-6 text-gray-200">ğŸ‘¥ æœ¬æ—¥ã®å‡ºå‹¤è€…</h3>
                            <div id="todayAttendance" class="space-y-3"></div>
                        </div>
                    </div>

                    <div class="luxury-card rounded-2xl p-8 shadow-xl">
                        <div class="flex justify-between items-center mb-8">
                            <h3 class="text-2xl font-semibold text-gray-200">ğŸ“‹ å‹¤æ€ å±¥æ­´</h3>
                            <button onclick="exportAttendanceCSV()" class="luxury-btn px-8 py-3 rounded-xl text-sm">
                                CSVå‡ºåŠ›
                            </button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full">
                                <thead>
                                    <tr>
                                        <th class="text-left py-5 px-6 text-gray-400 font-medium text-sm">æ—¥ä»˜</th>
                                        <th class="text-left py-5 px-6 text-gray-400 font-medium text-sm">ã‚­ãƒ£ã‚¹ãƒˆ</th>
                                        <th class="text-center py-5 px-6 text-gray-400 font-medium text-sm">å‡ºå‹¤</th>
                                        <th class="text-center py-5 px-6 text-gray-400 font-medium text-sm">é€€å‹¤</th>
                                        <th class="text-center py-5 px-6 text-gray-400 font-medium text-sm">åŠ´åƒæ™‚é–“</th>
                                        <th class="text-center py-5 px-6 text-gray-400 font-medium text-sm">çŠ¶æ…‹</th>
                                    </tr>
                                </thead>
                                <tbody id="attendanceTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- ãƒ†ãƒ¼ãƒ–ãƒ«ç®¡ç† -->
                <div id="tables-tab" class="tab-content">
                    <h1 class="text-5xl font-bold gold-accent mb-10">ãƒ†ãƒ¼ãƒ–ãƒ«ç®¡ç†</h1>
                    <div id="tablesGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4"></div>
                </div>

                <!-- ã‚·ãƒ•ãƒˆç®¡ç† -->
                <div id="shifts-tab" class="tab-content">
                    <h1 class="text-5xl font-bold gold-accent mb-8">ã‚·ãƒ•ãƒˆç®¡ç†</h1>
                    <div class="mb-8 flex gap-3">
                        <button onclick="openAddShiftModal()" class="luxury-btn px-8 py-3.5 rounded-xl text-sm">
                            â• ã‚·ãƒ•ãƒˆè¿½åŠ 
                        </button>
                        <button onclick="printShiftTable()" class="bg-gray-800 text-gray-300 px-8 py-3.5 rounded-xl hover:bg-gray-700 transition text-sm">
                            ğŸ–¨ï¸ å°åˆ·
                        </button>
                    </div>

                    <div class="luxury-card rounded-2xl p-8 shadow-xl mb-8">
                        <div class="flex items-center justify-between mb-8">
                            <button onclick="previousMonth()" class="px-6 py-3 bg-gray-800 rounded-xl hover:bg-gray-700 transition">â†</button>
                            <h3 class="text-2xl font-semibold text-gray-200" id="currentMonth">2024å¹´11æœˆ</h3>
                            <button onclick="nextMonth()" class="px-6 py-3 bg-gray-800 rounded-xl hover:bg-gray-700 transition">â†’</button>
                        </div>
                        <div class="calendar-grid" id="shiftCalendar"></div>
                    </div>

                    <div class="luxury-card rounded-2xl p-8 shadow-xl">
                        <h3 class="text-2xl font-semibold mb-6 text-gray-200">ä»Šé€±ã®ã‚·ãƒ•ãƒˆ</h3>
                        <div id="weeklyShifts" class="space-y-4"></div>
                    </div>
                </div>

                <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç† -->
                <div id="menu-tab" class="tab-content">
                    <div class="mb-10 flex justify-between items-start">
                        <div>
                            <h1 class="text-5xl font-bold gold-accent mb-3">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç†</h1>
                            <p class="text-gray-400 text-lg">å•†å“ç”»åƒä»˜ããƒ¡ãƒ‹ãƒ¥ãƒ¼</p>
                        </div>
                        <button onclick="openAddMenuModal()" class="luxury-btn px-8 py-3.5 rounded-xl text-sm">
                            â• ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¿½åŠ 
                        </button>
                    </div>
                    <div id="menuGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></div>
                </div>

                <!-- ã‚­ãƒ£ã‚¹ãƒˆç®¡ç† -->
                <div id="casts-tab" class="tab-content">
                    <div class="mb-10 flex justify-between items-center">
                        <h1 class="text-5xl font-bold gold-accent">ã‚­ãƒ£ã‚¹ãƒˆç®¡ç†</h1>
                        <button onclick="openAddCastModal()" class="luxury-btn px-8 py-3.5 rounded-xl text-sm">
                            â• ã‚­ãƒ£ã‚¹ãƒˆè¿½åŠ 
                        </button>
                    </div>
                    <div id="castsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                </div>

                <!-- å£²ä¸Šãƒ¬ãƒãƒ¼ãƒˆ -->
                <div id="reports-tab" class="tab-content">
                    <div class="mb-10">
                        <h1 class="text-5xl font-bold gold-accent mb-4">å£²ä¸Šãƒ¬ãƒãƒ¼ãƒˆ</h1>
                        <div class="mt-8 flex flex-wrap gap-3">
                            <button onclick="generateReport('daily')" class="luxury-btn px-8 py-3.5 rounded-xl text-sm">æ—¥æ¬¡</button>
                            <button onclick="generateReport('weekly')" class="bg-gray-800 text-gray-300 px-8 py-3.5 rounded-xl hover:bg-gray-700 transition text-sm">é€±æ¬¡</button>
                            <button onclick="generateReport('monthly')" class="bg-gray-800 text-gray-300 px-8 py-3.5 rounded-xl hover:bg-gray-700 transition text-sm">æœˆæ¬¡</button>
                            <button onclick="exportFullReport()" class="bg-gray-800 text-gray-300 px-8 py-3.5 rounded-xl hover:bg-gray-700 transition text-sm">ãƒ•ãƒ«å‡ºåŠ›</button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <div class="luxury-card rounded-2xl p-8 shadow-xl">
                            <h3 class="text-xl font-semibold mb-6 text-gray-200">æ—¥åˆ¥å£²ä¸Šæ¨ç§»</h3>
                            <canvas id="dailySalesChart"></canvas>
                        </div>
                        <div class="luxury-card rounded-2xl p-8 shadow-xl">
                            <h3 class="text-xl font-semibold mb-6 text-gray-200">ã‚«ãƒ†ã‚´ãƒªåˆ¥å£²ä¸Š</h3>
                            <canvas id="categorySalesChart"></canvas>
                        </div>
                    </div>

                    <div class="luxury-card rounded-2xl p-8 shadow-xl">
                        <h3 class="text-2xl font-semibold mb-8 text-gray-200">å£²ä¸Šæ˜ç´°</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full">
                                <thead>
                                    <tr>
                                        <th class="text-left py-5 px-6 text-gray-400 font-medium text-sm">æ—¥ä»˜</th>
                                        <th class="text-left py-5 px-6 text-gray-400 font-medium text-sm">ãƒ†ãƒ¼ãƒ–ãƒ«</th>
                                        <th class="text-center py-5 px-6 text-gray-400 font-medium text-sm">äººæ•°</th>
                                        <th class="text-right py-5 px-6 text-gray-400 font-medium text-sm">å£²ä¸Š</th>
                                    </tr>
                                </thead>
                                <tbody id="reportTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«: ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¿½åŠ  -->
    <div id="addMenuModal" class="modal fixed inset-0 z-50 items-center justify-center bg-black bg-opacity-70 p-4">
        <div class="w-full max-w-lg glass-effect rounded-2xl shadow-2xl">
            <div class="border-b border-gray-700 px-8 py-6 flex items-center justify-between">
                <h2 class="text-2xl font-bold gold-accent">ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¿½åŠ </h2>
                <button onclick="closeModal('addMenuModal')" class="text-gray-400 hover:text-gray-200 text-2xl">âœ•</button>
            </div>
            <div class="p-8">
                <form onsubmit="addMenuItem(event)" class="space-y-5">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">å•†å“ç”»åƒ</label>
                        <div class="image-upload-area rounded-xl p-8 text-center" onclick="document.getElementById('menuImageInput').click()">
                            <input type="file" id="menuImageInput" accept="image/*" class="hidden" onchange="previewMenuImage(event)">
                            <p class="text-gray-400 mb-2">ğŸ“¸ ã‚¯ãƒªãƒƒã‚¯ã—ã¦ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</p>
                            <p class="text-xs text-gray-500">JPG, PNG, GIF (æœ€å¤§5MB)</p>
                        </div>
                        <img id="menuImagePreview" class="image-preview hidden" />
                    </div>
                    <input type="text" id="menuName" placeholder="å•†å“å" class="w-full px-5 py-4 rounded-xl text-sm" required>
                    <select id="menuCategory" class="w-full px-5 py-4 rounded-xl text-sm">
                        <option value="bottle">ãƒœãƒˆãƒ«</option>
                        <option value="drink">ãƒ‰ãƒªãƒ³ã‚¯</option>
                        <option value="food">ãƒ•ãƒ¼ãƒ‰</option>
                        <option value="set">ã‚»ãƒƒãƒˆ</option>
                    </select>
                    <input type="number" id="menuPrice" placeholder="ä¾¡æ ¼" class="w-full px-5 py-4 rounded-xl text-sm" required>
                    <textarea id="menuDescription" placeholder="èª¬æ˜ï¼ˆä»»æ„ï¼‰" rows="3" class="w-full px-5 py-4 rounded-xl text-sm"></textarea>
                    <div class="flex gap-3 pt-4">
                        <button type="submit" class="flex-1 luxury-btn py-4 rounded-xl font-semibold">è¿½åŠ </button>
                        <button type="button" onclick="closeModal('addMenuModal')" class="flex-1 bg-gray-800 text-gray-300 py-4 rounded-xl hover:bg-gray-700 transition">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«: ã‚­ãƒ£ã‚¹ãƒˆè¿½åŠ  -->
    <div id="addCastModal" class="modal fixed inset-0 z-50 items-center justify-center bg-black bg-opacity-70 p-4">
        <div class="w-full max-w-md glass-effect rounded-2xl shadow-2xl">
            <div class="border-b border-gray-700 px-8 py-6 flex items-center justify-between">
                <h2 class="text-2xl font-bold gold-accent">ã‚­ãƒ£ã‚¹ãƒˆè¿½åŠ </h2>
                <button onclick="closeModal('addCastModal')" class="text-gray-400 hover:text-gray-200 text-2xl">âœ•</button>
            </div>
            <div class="p-8">
                <form onsubmit="addCast(event)" class="space-y-5">
                    <input type="text" id="castName" placeholder="åå‰" class="w-full px-5 py-4 rounded-xl text-sm" required>
                    <select id="castRank" class="w-full px-5 py-4 rounded-xl text-sm">
                        <option value="regular">ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼</option>
                        <option value="chief">ãƒãƒ¼ãƒ•</option>
                        <option value="manager">ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼</option>
                    </select>
                    <input type="number" id="castHourlyRate" placeholder="æ™‚çµ¦" class="w-full px-5 py-4 rounded-xl text-sm" required>
                    <div class="flex gap-3 pt-4">
                        <button type="submit" class="flex-1 luxury-btn py-4 rounded-xl font-semibold">è¿½åŠ </button>
                        <button type="button" onclick="closeModal('addCastModal')" class="flex-1 bg-gray-800 text-gray-300 py-4 rounded-xl hover:bg-gray-700 transition">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«: ã‚­ãƒ£ã‚¹ãƒˆç·¨é›† -->
    <div id="editCastModal" class="modal fixed inset-0 z-50 items-center justify-center bg-black bg-opacity-70 p-4">
        <div class="w-full max-w-md glass-effect rounded-2xl shadow-2xl">
            <div class="border-b border-gray-700 px-8 py-6 flex items-center justify-between">
                <h2 class="text-2xl font-bold gold-accent">ã‚­ãƒ£ã‚¹ãƒˆç·¨é›†</h2>
                <button onclick="closeModal('editCastModal')" class="text-gray-400 hover:text-gray-200 text-2xl">âœ•</button>
            </div>
            <div class="p-8">
                <form onsubmit="updateCast(event)" class="space-y-5">
                    <input type="hidden" id="editCastId">
                    <input type="text" id="editCastName" placeholder="åå‰" class="w-full px-5 py-4 rounded-xl text-sm" required>
                    <select id="editCastRank" class="w-full px-5 py-4 rounded-xl text-sm">
                        <option value="regular">ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼</option>
                        <option value="chief">ãƒãƒ¼ãƒ•</option>
                        <option value="manager">ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼</option>
                    </select>
                    <input type="number" id="editCastHourlyRate" placeholder="æ™‚çµ¦" class="w-full px-5 py-4 rounded-xl text-sm" required>
                    <div class="flex gap-3 pt-4">
                        <button type="submit" class="flex-1 luxury-btn py-4 rounded-xl font-semibold">æ›´æ–°</button>
                        <button type="button" onclick="closeModal('editCastModal')" class="flex-1 bg-gray-800 text-gray-300 py-4 rounded-xl hover:bg-gray-700 transition">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«: ã‚·ãƒ•ãƒˆè¿½åŠ  -->
    <div id="addShiftModal" class="modal fixed inset-0 z-50 items-center justify-center bg-black bg-opacity-70 p-4">
        <div class="w-full max-w-md glass-effect rounded-2xl shadow-2xl">
            <div class="border-b border-gray-700 px-8 py-6 flex items-center justify-between">
                <h2 class="text-2xl font-bold gold-accent">ã‚·ãƒ•ãƒˆç™»éŒ²</h2>
                <button onclick="closeModal('addShiftModal')" class="text-gray-400 hover:text-gray-200 text-2xl">âœ•</button>
            </div>
            <div class="p-8">
                <form onsubmit="saveShift(event)" class="space-y-5">
                    <select id="shiftCast" class="w-full px-5 py-4 rounded-xl text-sm" required>
                        <option value="">ã‚­ãƒ£ã‚¹ãƒˆã‚’é¸æŠ</option>
                    </select>
                    <input type="date" id="shiftDate" class="w-full px-5 py-4 rounded-xl text-sm" required>
                    <div class="grid grid-cols-2 gap-4">
                        <input type="time" id="shiftStart" value="20:00" class="w-full px-5 py-4 rounded-xl text-sm">
                        <input type="time" id="shiftEnd" value="01:00" class="w-full px-5 py-4 rounded-xl text-sm">
                    </div>
                    <div class="flex gap-3 pt-4">
                        <button type="submit" class="flex-1 luxury-btn py-4 rounded-xl font-semibold">ç™»éŒ²</button>
                        <button type="button" onclick="closeModal('addShiftModal')" class="flex-1 bg-gray-800 text-gray-300 py-4 rounded-xl hover:bg-gray-700 transition">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api/v1';
        
        const appState = {
            currentUser: null,
            currentMonth: new Date(),
            tables: [],
            sessions: [],
            menuItems: [],
            casts: [],
            orders: [],
            shifts: [],
            attendances: [],
            sales: 0,
            apiConnected: false,
            currentMenuImage: null
        };

        function initializeApp() {
            setupBusinessDate();
            loadDemoData();
            syncWithBackend();
            setupCharts();
            updateDashboard();
            initializeShiftCalendar();
            renderAttendance();
            populateCastSelects();
        }

        function setupBusinessDate() {
            const today = new Date();
            document.getElementById('businessDate').textContent = 
                today.toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });
        }

        function loadDemoData() {
            appState.tables = [
                { id: 1, name: 'A1', status: 'available' },
                { id: 2, name: 'A2', status: 'occupied' },
                { id: 3, name: 'VIP1', status: 'occupied', isVip: true },
                { id: 4, name: 'B1', status: 'available' },
                { id: 5, name: 'B2', status: 'reserved' },
                { id: 6, name: 'C1', status: 'available' }
            ];

            appState.menuItems = [
                { 
                    id: 1, 
                    name: 'ãƒ‰ãƒ³ãƒšãƒªãƒ‹ãƒ¨ãƒ³ ãƒ­ã‚¼', 
                    category: 'bottle', 
                    price: 150000, 
                    stock: 5,
                    description: 'ãƒ—ãƒ¬ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ¥ ã‚·ãƒ£ãƒ³ãƒ‘ãƒ³',
                    image: null
                },
                { 
                    id: 2, 
                    name: 'ãƒã‚¤ãƒœãƒ¼ãƒ«', 
                    category: 'drink', 
                    price: 800, 
                    stock: 100,
                    description: 'ã‚¯ãƒ©ã‚·ãƒƒã‚¯ãƒã‚¤ãƒœãƒ¼ãƒ«',
                    image: null
                },
                { 
                    id: 3, 
                    name: '90åˆ†ã‚»ãƒƒãƒˆ', 
                    category: 'set', 
                    price: 5000, 
                    stock: null,
                    description: 'é£²ã¿æ”¾é¡Œä»˜ã',
                    image: null
                },
                { 
                    id: 4, 
                    name: 'ãƒ•ãƒ«ãƒ¼ãƒ„ç››ã‚Šåˆã‚ã›', 
                    category: 'food', 
                    price: 8000, 
                    stock: 20,
                    description: 'å­£ç¯€ã®ãƒ•ãƒ«ãƒ¼ãƒ„',
                    image: null
                }
            ];

            appState.casts = [
                { id: 1, name: 'ã•ãã‚‰', rank: 'chief', hourlyRate: 3500, sales: 285000 },
                { id: 2, name: 'ã‚†ã', rank: 'regular', hourlyRate: 2500, sales: 168000 },
                { id: 3, name: 'ã¿ã‹', rank: 'manager', hourlyRate: 4000, sales: 342000 }
            ];

            appState.sessions = [
                { id: 1, tableId: 2, startTime: '21:30', guests: 4, total: 26400 },
                { id: 2, tableId: 3, startTime: '20:00', guests: 6, total: 160000 }
            ];

            appState.attendances = [
                { id: 1, castId: 1, date: new Date().toISOString().split('T')[0], clockIn: '20:00', clockOut: null, status: 'working' }
            ];

            renderTables();
            renderMenu();
            renderCasts();
            renderReports();
        }

        async function syncWithBackend() {
            try {
                showNotification('APIã¨åŒæœŸä¸­...', 'info');
                
                const [tables, menu, casts] = await Promise.all([
                    fetch(`${API_BASE}/tables`).then(r => r.ok ? r.json() : []),
                    fetch(`${API_BASE}/menu`).then(r => r.ok ? r.json() : []),
                    fetch(`${API_BASE}/casts`).then(r => r.ok ? r.json() : [])
                ]);

                if (tables.length) appState.tables = tables;
                if (menu.length) appState.menuItems = menu;
                if (casts.length) appState.casts = casts;

                appState.apiConnected = true;
                showNotification('APIåŒæœŸå®Œäº†ï¼', 'success');
                
                renderTables();
                renderMenu();
                renderCasts();
            } catch (error) {
                console.error('APIåŒæœŸã‚¨ãƒ©ãƒ¼:', error);
                showNotification('APIã‚ªãƒ•ãƒ©ã‚¤ãƒ³ - ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œä¸­', 'warning');
                appState.apiConnected = false;
            }
        }

        function handleLogin(event) {
            event.preventDefault();
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('dashboardPage').classList.remove('hidden');
            initializeApp();
            showNotification('ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ãŸ', 'success');
        }

        function logout() {
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('dashboardPage').classList.add('hidden');
            showNotification('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ', 'info');
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabName + '-tab').classList.add('active');
            
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // å•†å“ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
        function previewMenuImage(event) {
            const file = event.target.files[0];
            if (file) {
                if (file.size > 5 * 1024 * 1024) {
                    showNotification('ç”»åƒã‚µã‚¤ã‚ºã¯5MBä»¥ä¸‹ã«ã—ã¦ãã ã•ã„', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    appState.currentMenuImage = e.target.result;
                    const preview = document.getElementById('menuImagePreview');
                    preview.src = e.target.result;
                    preview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        }

        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤º
        function renderMenu() {
            const grid = document.getElementById('menuGrid');
            if (!grid) return;
            
            grid.innerHTML = appState.menuItems.map(item => `
                <div class="luxury-card rounded-2xl overflow-hidden shadow-xl">
                    <div class="menu-image-container">
                        ${item.image ? 
                            `<img src="${item.image}" class="menu-image" alt="${item.name}" />` :
                            `<div class="w-full h-full flex items-center justify-center bg-gradient-to-br from-gray-800 to-gray-900">
                                <span class="text-6xl">${getCategoryEmoji(item.category)}</span>
                            </div>`
                        }
                    </div>
                    <div class="p-6">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex-1">
                                <h3 class="text-lg font-bold text-gray-200 mb-1">${item.name}</h3>
                                <p class="text-xs text-gray-400">${item.description || ''}</p>
                            </div>
                            <span class="ml-2 text-xs px-3 py-1 rounded-full ${getCategoryColor(item.category)}">
                                ${getCategoryLabel(item.category)}
                            </span>
                        </div>
                        <div class="flex items-center justify-between mb-4">
                            <p class="text-2xl font-bold gold-accent">Â¥${item.price.toLocaleString()}</p>
                            <p class="text-sm text-gray-400">åœ¨åº«: ${item.stock || 'âˆ'}</p>
                        </div>
                        <button onclick="deleteMenuItem(${item.id})" class="w-full bg-red-900/20 border border-red-800/30 text-red-400 py-3 rounded-xl hover:bg-red-900/30 transition text-sm">
                            å‰Šé™¤
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function getCategoryEmoji(category) {
            const emojis = { bottle: 'ğŸ¾', drink: 'ğŸ¥ƒ', food: 'ğŸ½ï¸', set: 'âœ¨' };
            return emojis[category] || 'ğŸ´';
        }

        function getCategoryColor(category) {
            const colors = {
                bottle: 'bg-purple-900/30 text-purple-400',
                drink: 'bg-blue-900/30 text-blue-400',
                food: 'bg-green-900/30 text-green-400',
                set: 'bg-yellow-900/30 text-yellow-400'
            };
            return colors[category] || 'bg-gray-900/30 text-gray-400';
        }

        function getCategoryLabel(category) {
            const labels = { bottle: 'ãƒœãƒˆãƒ«', drink: 'ãƒ‰ãƒªãƒ³ã‚¯', food: 'ãƒ•ãƒ¼ãƒ‰', set: 'ã‚»ãƒƒãƒˆ' };
            return labels[category] || category;
        }

        function openAddMenuModal() {
            appState.currentMenuImage = null;
            document.getElementById('menuImageInput').value = '';
            document.getElementById('menuImagePreview').classList.add('hidden');
            document.getElementById('addMenuModal').classList.add('active');
        }

        async function addMenuItem(event) {
            event.preventDefault();
            
            const newItem = {
                id: appState.menuItems.length + 1,
                name: document.getElementById('menuName').value,
                category: document.getElementById('menuCategory').value,
                price: parseInt(document.getElementById('menuPrice').value),
                description: document.getElementById('menuDescription').value,
                stock: 10,
                image: appState.currentMenuImage
            };

            appState.menuItems.push(newItem);
            
            if (appState.apiConnected) {
                try {
                    await fetch(`${API_BASE}/menu`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(newItem)
                    });
                } catch (error) {
                    console.error('ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¿½åŠ ã‚¨ãƒ©ãƒ¼:', error);
                }
            }

            renderMenu();
            closeModal('addMenuModal');
            showNotification('ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ ã—ã¾ã—ãŸ', 'success');
        }

        function deleteMenuItem(id) {
            if (confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                appState.menuItems = appState.menuItems.filter(item => item.id !== id);
                renderMenu();
                showNotification('å‰Šé™¤ã—ã¾ã—ãŸ', 'info');
            }
        }

        // ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤º
        function renderTables() {
            const grid = document.getElementById('tablesGrid');
            if (!grid) return;
            
            grid.innerHTML = appState.tables.map(table => {
                const statusClass = {
                    'available': 'bg-green-900/20 border-green-700/40',
                    'occupied': 'bg-red-900/20 border-red-700/40',
                    'reserved': 'bg-yellow-900/20 border-yellow-700/40'
                }[table.status];
                
                const statusText = {
                    'available': 'ç©ºå¸­',
                    'occupied': 'ä½¿ç”¨ä¸­',
                    'reserved': 'äºˆç´„'
                }[table.status];

                const statusDot = {
                    'available': 'status-available',
                    'occupied': 'status-occupied',
                    'reserved': 'status-reserved'
                }[table.status];
                
                return `
                    <div class="luxury-card ${statusClass} rounded-2xl p-6 cursor-pointer hover:shadow-2xl transition-all">
                        ${table.isVip ? '<div class="text-xs gold-accent font-bold mb-2">â­ VIP</div>' : ''}
                        <div class="text-center">
                            <p class="text-3xl font-bold text-gray-200 mb-2">${table.name}</p>
                            <div class="flex items-center justify-center">
                                <span class="status-dot ${statusDot}"></span>
                                <span class="text-sm text-gray-400">${statusText}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ã‚­ãƒ£ã‚¹ãƒˆè¡¨ç¤º
        function renderCasts() {
            const grid = document.getElementById('castsGrid');
            if (!grid) return;
            
            grid.innerHTML = appState.casts.map(cast => `
                <div class="luxury-card rounded-2xl p-8 shadow-xl">
                    <div class="flex items-center justify-center mb-6">
                        <div class="w-20 h-20 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-3xl">
                            ğŸ‘¤
                        </div>
                    </div>
                    <div class="text-center mb-6">
                        <h3 class="text-2xl font-bold text-gray-200 mb-2">${cast.name}</h3>
                        <span class="text-xs px-4 py-2 rounded-full ${getRankColor(cast.rank)}">
                            ${getRankLabel(cast.rank)}
                        </span>
                    </div>
                    <div class="space-y-3 text-sm mb-6">
                        <div class="flex justify-between items-center p-3 bg-gray-800/30 rounded-lg">
                            <span class="text-gray-400">æ™‚çµ¦</span>
                            <span class="font-semibold text-gray-200">Â¥${cast.hourlyRate.toLocaleString()}</span>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-gray-800/30 rounded-lg">
                            <span class="text-gray-400">æœ¬æ—¥å£²ä¸Š</span>
                            <span class="font-semibold gold-accent">Â¥${cast.sales.toLocaleString()}</span>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="editCast(${cast.id})" class="bg-blue-900/30 border border-blue-700/50 text-blue-400 py-3 rounded-xl hover:bg-blue-900/50 transition text-sm font-medium">
                            ç·¨é›†
                        </button>
                        <button onclick="deleteCast(${cast.id})" class="bg-red-900/30 border border-red-700/50 text-red-400 py-3 rounded-xl hover:bg-red-900/50 transition text-sm font-medium">
                            å‰Šé™¤
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function getRankColor(rank) {
            const colors = {
                regular: 'bg-gray-900/30 text-gray-400',
                chief: 'bg-blue-900/30 text-blue-400',
                manager: 'bg-purple-900/30 text-purple-400'
            };
            return colors[rank] || 'bg-gray-900/30 text-gray-400';
        }

        function getRankLabel(rank) {
            const labels = { regular: 'ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼', chief: 'ãƒãƒ¼ãƒ•', manager: 'ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼' };
            return labels[rank] || rank;
        }

        function openAddCastModal() {
            document.getElementById('addCastModal').classList.add('active');
        }

        async function addCast(event) {
            event.preventDefault();
            
            const newCast = {
                id: appState.casts.length + 1,
                name: document.getElementById('castName').value,
                rank: document.getElementById('castRank').value,
                hourlyRate: parseInt(document.getElementById('castHourlyRate').value),
                sales: 0
            };

            appState.casts.push(newCast);
            
            if (appState.apiConnected) {
                try {
                    await fetch(`${API_BASE}/casts`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(newCast)
                    });
                } catch (error) {
                    console.error('ã‚­ãƒ£ã‚¹ãƒˆè¿½åŠ ã‚¨ãƒ©ãƒ¼:', error);
                }
            }

            renderCasts();
            populateCastSelects();
            closeModal('addCastModal');
            showNotification('ã‚­ãƒ£ã‚¹ãƒˆã‚’è¿½åŠ ã—ã¾ã—ãŸ', 'success');
        }

        function editCast(id) {
            const cast = appState.casts.find(c => c.id === id);
            if (!cast) return;
            
            document.getElementById('editCastId').value = cast.id;
            document.getElementById('editCastName').value = cast.name;
            document.getElementById('editCastRank').value = cast.rank;
            document.getElementById('editCastHourlyRate').value = cast.hourlyRate;
            
            document.getElementById('editCastModal').classList.add('active');
        }

        async function updateCast(event) {
            event.preventDefault();
            
            const id = parseInt(document.getElementById('editCastId').value);
            const cast = appState.casts.find(c => c.id === id);
            
            if (cast) {
                cast.name = document.getElementById('editCastName').value;
                cast.rank = document.getElementById('editCastRank').value;
                cast.hourlyRate = parseInt(document.getElementById('editCastHourlyRate').value);
                
                if (appState.apiConnected) {
                    try {
                        await fetch(`${API_BASE}/casts/${id}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(cast)
                        });
                    } catch (error) {
                        console.error('APIæ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
                    }
                }
                
                renderCasts();
                populateCastSelects();
                closeModal('editCastModal');
                showNotification('ã‚­ãƒ£ã‚¹ãƒˆæƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸ', 'success');
            }
        }

        function deleteCast(id) {
            if (confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                appState.casts = appState.casts.filter(cast => cast.id !== id);
                renderCasts();
                populateCastSelects();
                showNotification('å‰Šé™¤ã—ã¾ã—ãŸ', 'info');
            }
        }

        // å‹¤æ€ ç®¡ç†
        function populateCastSelects() {
            const select = document.getElementById('attendanceCast');
            const shiftSelect = document.getElementById('shiftCast');
            
            const options = '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>' + 
                appState.casts.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
            
            if (select) select.innerHTML = options;
            if (shiftSelect) shiftSelect.innerHTML = options;
        }

        function clockIn() {
            const castId = parseInt(document.getElementById('attendanceCast').value);
            if (!castId) {
                showNotification('ã‚­ãƒ£ã‚¹ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„', 'warning');
                return;
            }

            const now = new Date();
            const attendance = {
                id: appState.attendances.length + 1,
                castId: castId,
                date: now.toISOString().split('T')[0],
                clockIn: now.toTimeString().split(' ')[0],
                clockOut: null,
                status: 'working'
            };

            appState.attendances.push(attendance);
            showNotification('å‡ºå‹¤æ‰“åˆ»ã—ã¾ã—ãŸ', 'success');
            renderAttendance();
        }

        function clockOut() {
            const castId = parseInt(document.getElementById('attendanceCast').value);
            if (!castId) {
                showNotification('ã‚­ãƒ£ã‚¹ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„', 'warning');
                return;
            }

            const attendance = appState.attendances.find(a => 
                a.castId === castId && 
                a.date === new Date().toISOString().split('T')[0] && 
                a.status === 'working'
            );

            if (!attendance) {
                showNotification('å‡ºå‹¤è¨˜éŒ²ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
                return;
            }

            attendance.clockOut = new Date().toTimeString().split(' ')[0];
            attendance.status = 'completed';
            
            showNotification('é€€å‹¤æ‰“åˆ»ã—ã¾ã—ãŸ', 'success');
            renderAttendance();
        }

        function renderAttendance() {
            const today = new Date().toISOString().split('T')[0];
            const todayAttendances = appState.attendances.filter(a => a.date === today && a.status === 'working');
            
            const todayDiv = document.getElementById('todayAttendance');
            if (todayDiv) {
                todayDiv.innerHTML = todayAttendances.length === 0 
                    ? '<p class="text-gray-500 text-center py-6">å‡ºå‹¤è€…ãªã—</p>'
                    : todayAttendances.map(a => {
                        const cast = appState.casts.find(c => c.id === a.castId);
                        return `
                            <div class="flex justify-between items-center p-4 bg-green-900/20 border border-green-700/40 rounded-xl">
                                <div>
                                    <p class="font-semibold text-gray-200">${cast?.name || ''}</p>
                                    <p class="text-xs text-gray-400">å‡ºå‹¤: ${a.clockIn}</p>
                                </div>
                                <span class="text-xs px-3 py-1 bg-green-900/40 text-green-400 rounded-full">å‹¤å‹™ä¸­</span>
                            </div>
                        `;
                    }).join('');
            }

            const tbody = document.getElementById('attendanceTableBody');
            if (tbody) {
                tbody.innerHTML = appState.attendances.slice().reverse().map(a => {
                    const cast = appState.casts.find(c => c.id === a.castId);
                    const hours = a.clockOut ? calculateHours(a.clockIn, a.clockOut) : '-';
                    const status = a.status === 'working' ? 'å‹¤å‹™ä¸­' : 'é€€å‹¤æ¸ˆ';
                    const statusClass = a.status === 'working' ? 'text-green-400' : 'text-gray-400';
                    
                    return `
                        <tr>
                            <td class="py-4 px-6 text-gray-300">${a.date}</td>
                            <td class="py-4 px-6 text-gray-300">${cast?.name || ''}</td>
                            <td class="py-4 px-6 text-center text-gray-300">${a.clockIn}</td>
                            <td class="py-4 px-6 text-center text-gray-300">${a.clockOut || '-'}</td>
                            <td class="py-4 px-6 text-center text-gray-300">${hours}</td>
                            <td class="py-4 px-6 text-center ${statusClass} font-medium">${status}</td>
                        </tr>
                    `;
                }).join('');
            }
        }

        function calculateHours(clockIn, clockOut) {
            const [h1, m1] = clockIn.split(':').map(Number);
            const [h2, m2] = clockOut.split(':').map(Number);
            const minutes = (h2 * 60 + m2) - (h1 * 60 + m1);
            const hours = Math.floor(minutes / 60);
            const mins = minutes % 60;
            return `${hours}æ™‚é–“${mins}åˆ†`;
        }

        function exportAttendanceCSV() {
            const csv = 'æ—¥ä»˜,ã‚­ãƒ£ã‚¹ãƒˆ,å‡ºå‹¤,é€€å‹¤,åŠ´åƒæ™‚é–“,çŠ¶æ…‹\n' + 
                appState.attendances.map(a => {
                    const cast = appState.casts.find(c => c.id === a.castId);
                    const hours = a.clockOut ? calculateHours(a.clockIn, a.clockOut) : '-';
                    return `${a.date},${cast?.name},${a.clockIn},${a.clockOut || ''},${hours},${a.status}`;
                }).join('\n');
            
            downloadCSV(csv, 'attendance.csv');
            showNotification('å‹¤æ€ CSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ', 'success');
        }

        // ã‚·ãƒ•ãƒˆç®¡ç†
        function initializeShiftCalendar() {
            appState.shifts = [
                { id: 1, castId: 1, date: '2024-11-08', start: '20:00', end: '01:00' },
                { id: 2, castId: 2, date: '2024-11-08', start: '21:00', end: '02:00' }
            ];
            renderShiftCalendar();
            renderWeeklyShifts();
        }

        function renderShiftCalendar() {
            const calendar = document.getElementById('shiftCalendar');
            if (!calendar) return;

            const year = appState.currentMonth.getFullYear();
            const month = appState.currentMonth.getMonth();
            const firstDay = new Date(year, month, 1).getDay();
            const lastDate = new Date(year, month + 1, 0).getDate();

            document.getElementById('currentMonth').textContent = `${year}å¹´${month + 1}æœˆ`;

            let html = '';
            const weekDays = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
            weekDays.forEach(day => {
                html += `<div class="text-center font-semibold p-3 text-gray-400 text-sm">${day}</div>`;
            });

            for (let i = 0; i < firstDay; i++) {
                html += `<div class="p-2"></div>`;
            }

            for (let date = 1; date <= lastDate; date++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
                const shiftsForDate = appState.shifts.filter(s => s.date === dateStr);
                const isToday = dateStr === new Date().toISOString().split('T')[0];
                
                html += `<div class="calendar-cell border border-gray-800 ${isToday ? 'bg-yellow-900/10 border-yellow-700/30' : ''}">
                    <div class="font-semibold text-sm mb-2 ${isToday ? 'text-yellow-500' : 'text-gray-400'}">${date}</div>
                    <div class="space-y-1">
                        ${shiftsForDate.map(shift => {
                            const cast = appState.casts.find(c => c.id === shift.castId);
                            return `<div class="shift-badge">${cast?.name || ''}</div>`;
                        }).join('')}
                    </div>
                </div>`;
            }

            calendar.innerHTML = html;
        }

        function renderWeeklyShifts() {
            const container = document.getElementById('weeklyShifts');
            if (!container) return;

            const today = new Date();
            const weekShifts = appState.shifts.filter(s => {
                const shiftDate = new Date(s.date);
                const diff = Math.floor((shiftDate - today) / (1000 * 60 * 60 * 24));
                return diff >= 0 && diff < 7;
            });

            container.innerHTML = weekShifts.length === 0 
                ? '<p class="text-gray-500 text-center py-6">ä»Šé€±ã®ã‚·ãƒ•ãƒˆãªã—</p>'
                : weekShifts.map(shift => {
                    const cast = appState.casts.find(c => c.id === shift.castId);
                    return `
                        <div class="flex justify-between items-center p-5 bg-gray-800/30 rounded-xl hover:bg-gray-800/50 transition">
                            <div>
                                <p class="font-bold text-lg text-gray-200">${cast?.name || ''}</p>
                                <p class="text-sm text-gray-400">${shift.date}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-sm text-gray-300">${shift.start} - ${shift.end}</p>
                            </div>
                        </div>
                    `;
                }).join('');
        }

        function openAddShiftModal() {
            populateCastSelects();
            document.getElementById('addShiftModal').classList.add('active');
        }

        async function saveShift(event) {
            event.preventDefault();
            
            const shift = {
                id: appState.shifts.length + 1,
                castId: parseInt(document.getElementById('shiftCast').value),
                date: document.getElementById('shiftDate').value,
                start: document.getElementById('shiftStart').value,
                end: document.getElementById('shiftEnd').value
            };

            appState.shifts.push(shift);
            
            if (appState.apiConnected) {
                try {
                    await fetch(`${API_BASE}/shifts`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(shift)
                    });
                } catch (error) {
                    console.error('ã‚·ãƒ•ãƒˆç™»éŒ²ã‚¨ãƒ©ãƒ¼:', error);
                }
            }

            renderShiftCalendar();
            renderWeeklyShifts();
            closeModal('addShiftModal');
            showNotification('ã‚·ãƒ•ãƒˆã‚’ç™»éŒ²ã—ã¾ã—ãŸ', 'success');
        }

        function previousMonth() {
            appState.currentMonth.setMonth(appState.currentMonth.getMonth() - 1);
            renderShiftCalendar();
        }

        function nextMonth() {
            appState.currentMonth.setMonth(appState.currentMonth.getMonth() + 1);
            renderShiftCalendar();
        }

        // ãƒ¬ãƒãƒ¼ãƒˆ
        function renderReports() {
            const tbody = document.getElementById('reportTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = appState.sessions.map(session => {
                const table = appState.tables.find(t => t.id === session.tableId);
                return `
                    <tr>
                        <td class="py-4 px-6 text-gray-300">${new Date().toLocaleDateString()}</td>
                        <td class="py-4 px-6 text-gray-300">${table?.name || '-'}</td>
                        <td class="py-4 px-6 text-center text-gray-300">${session.guests}</td>
                        <td class="py-4 px-6 text-right font-semibold gold-accent">Â¥${session.total.toLocaleString()}</td>
                    </tr>
                `;
            }).join('');
        }

        function generateReport(type) {
            showNotification(`${type}ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆä¸­...`, 'info');
            setTimeout(() => {
                showNotification(`${type}ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¾ã—ãŸ`, 'success');
            }, 1000);
        }

        function exportFullReport() {
            showNotification('ãƒ•ãƒ«ãƒ¬ãƒãƒ¼ãƒˆã‚’å‡ºåŠ›ä¸­...', 'info');
            setTimeout(() => {
                showNotification('ãƒ•ãƒ«ãƒ¬ãƒãƒ¼ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ', 'success');
            }, 1500);
        }

        // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ›´æ–°
        function updateDashboard() {
            const totalSales = appState.sessions.reduce((sum, s) => sum + s.total, 0);
            const workingCount = appState.attendances.filter(a => a.status === 'working').length;
            
            document.getElementById('totalSales').textContent = `Â¥${totalSales.toLocaleString()}`;
            document.getElementById('totalCustomers').textContent = appState.sessions.length + 'çµ„';
            document.getElementById('workingCasts').textContent = workingCount + 'å';
            
            const avg = totalSales / (appState.sessions.length || 1);
            document.getElementById('averageSpend').textContent = `Â¥${Math.round(avg).toLocaleString()}`;

            const activities = document.getElementById('recentActivities');
            if (activities) {
                activities.innerHTML = `
                    <div class="flex justify-between items-center py-3 border-b border-gray-800">
                        <div>
                            <p class="text-sm text-gray-300">ãƒ†ãƒ¼ãƒ–ãƒ«A2ã‚’é–‹ãã¾ã—ãŸ</p>
                            <p class="text-xs text-gray-500">22:30</p>
                        </div>
                        <span class="text-xs px-3 py-1 bg-green-900/30 text-green-400 rounded-full">æ–°è¦</span>
                    </div>
                    <div class="flex justify-between items-center py-3 border-b border-gray-800">
                        <div>
                            <p class="text-sm text-gray-300">VIP1ã«æ³¨æ–‡è¿½åŠ </p>
                            <p class="text-xs text-gray-500">22:15</p>
                        </div>
                        <span class="text-xs px-3 py-1 bg-blue-900/30 text-blue-400 rounded-full">æ³¨æ–‡</span>
                    </div>
                    <div class="flex justify-between items-center py-3">
                        <div>
                            <p class="text-sm text-gray-300">ã•ãã‚‰å‡ºå‹¤æ‰“åˆ»</p>
                            <p class="text-xs text-gray-500">20:00</p>
                        </div>
                        <span class="text-xs px-3 py-1 bg-purple-900/30 text-purple-400 rounded-full">å‹¤æ€ </span>
                    </div>
                `;
            }
        }

        // ã‚°ãƒ©ãƒ•è¨­å®š
        function setupCharts() {
            Chart.defaults.color = '#9ca3af';
            Chart.defaults.borderColor = 'rgba(255, 255, 255, 0.1)';
            
            const salesCtx = document.getElementById('salesChart');
            if (salesCtx) {
                new Chart(salesCtx, {
                    type: 'bar',
                    data: {
                        labels: ['19æ™‚', '20æ™‚', '21æ™‚', '22æ™‚', '23æ™‚', '24æ™‚'],
                        datasets: [{
                            label: 'å£²ä¸Š',
                            data: [120000, 180000, 320000, 280000, 150000, 80000],
                            backgroundColor: 'rgba(212, 175, 55, 0.6)',
                            borderColor: 'rgba(212, 175, 55, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: { 
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            }

            const dailyCtx = document.getElementById('dailySalesChart');
            if (dailyCtx) {
                new Chart(dailyCtx, {
                    type: 'line',
                    data: {
                        labels: ['æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ', 'æ—¥'],
                        datasets: [{
                            label: 'å£²ä¸Š',
                            data: [980000, 1120000, 890000, 1340000, 1560000, 1890000, 1650000],
                            borderColor: 'rgba(212, 175, 55, 1)',
                            backgroundColor: 'rgba(212, 175, 55, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: { 
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            }

            const categoryCtx = document.getElementById('categorySalesChart');
            if (categoryCtx) {
                new Chart(categoryCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['ãƒœãƒˆãƒ«', 'ãƒ‰ãƒªãƒ³ã‚¯', 'ãƒ•ãƒ¼ãƒ‰', 'ã‚»ãƒƒãƒˆ'],
                        datasets: [{
                            data: [450000, 120000, 80000, 150000],
                            backgroundColor: [
                                'rgba(212, 175, 55, 0.8)',
                                'rgba(147, 51, 234, 0.8)',
                                'rgba(59, 130, 246, 0.8)',
                                'rgba(16, 185, 129, 0.8)'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: { 
                        responsive: true,
                        maintainAspectRatio: true
                    }
                });
            }
        }

        // å°åˆ·ãƒ»ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        function printDailyReport() {
            window.print();
            showNotification('æ—¥å ±ã‚’å°åˆ·ã—ã¾ã™', 'info');
        }

        function printShiftTable() {
            window.print();
            showNotification('ã‚·ãƒ•ãƒˆè¡¨ã‚’å°åˆ·ã—ã¾ã™', 'info');
        }

        function exportCSV() {
            const csv = 'ãƒ†ãƒ¼ãƒ–ãƒ«,æ™‚é–“,äººæ•°,å£²ä¸Š\n' + 
                appState.sessions.map(s => {
                    const table = appState.tables.find(t => t.id === s.tableId);
                    return `${table?.name},${s.startTime},${s.guests},${s.total}`;
                }).join('\n');
            
            downloadCSV(csv, 'sales.csv');
            showNotification('CSVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ', 'success');
        }

        function downloadCSV(content, filename) {
            const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function toggleMobileSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
        }

        function showNotification(message, type = 'info') {
            const colors = {
                success: 'bg-green-900/90 border-green-700',
                error: 'bg-red-900/90 border-red-700',
                warning: 'bg-yellow-900/90 border-yellow-700',
                info: 'bg-blue-900/90 border-blue-700'
            };
            
            const icons = {
                success: 'âœ…',
                error: 'âŒ',
                warning: 'âš ï¸',
                info: 'â„¹ï¸'
            };
            
            const notification = document.createElement('div');
            notification.className = `notification ${colors[type]} border px-6 py-4 rounded-xl shadow-2xl backdrop-blur-sm`;
            notification.innerHTML = `
                <div class="flex items-center gap-3">
                    <span class="text-2xl">${icons[type]}</span>
                    <span class="text-gray-200 font-medium">${message}</span>
                </div>
            `;
            
            document.getElementById('notificationArea').appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
        });
    </script>
</body>
</html>